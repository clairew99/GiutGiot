# Î∞∞Ìè¨ Í∞ÄÏù¥Îìú

# üîé Stacks

### Management Tool

`Jira` `Mattermost` `Discord` `Notion` `GitLab` `Figma` `ERDCloud`

### IDE

`VSCode` `Intellij` `Android Studio`

### Infra

`EC2` `Docker(25.0.4)` `Ubuntu(20.04.6)` `Jenkins(2.469)`

### Frontend

`HTML5` `CSS` `JS` `React(18.2.0)` `Axios(1.6.8)` `React-Router-Dom(6.22.3)` `Node(20.11.1)` `React-Dom(18.2.0)` `Zustand(4.5.2)` `Styled-Components(6.1.8)` 

### Backend

`Java(17)` `Spring boot(3.2.3)` `Spring Date JPA(3.2.3)` `jjwt(0.12.5)` `QueryDsl(5.0.0)` `Mysql(8.0)` `Redis(7.2.4)` `Elasticsearch(8.12.2)`

### AI

`Python(3.11)` `FastAPI(0.110.0)` `uvicorn(0.29.0)` `tensorflow(2.15.0)` `konply(0.6.0)` `pandas(2.2.1)` `numpy(1.26.4)` `scikit-learn(1.12.0)` `jupyter hub(4.0.2)`

# üóÉÔ∏è Build & Distribute

## Backend Build

### application.yml

```
spring:
  datasource:
    driver-class-name: {DB Driver}
    url: {DB URL}
    username: {DB username}
    password: {DB password}
    hikari:
      maximum-pool-size: {Pool SIze}
  jpa:
    hibernate:
      ddl-auto: update
    defer-datasource-initialization: true
  sql:
    init:
      mode: always
  servlet:
    multipart:
      max-file-size: {ÏóÖÎ°úÎìú Ïö©Îüâ Ï†úÌïú}
      max-request-size: {ÏóÖÎ°úÎìú Ïö©Îüâ Ï†úÌïú}
  jackson:
    time-zone: {ÌÉÄÏûÑÏ°¥ ÏÑ∏ÌåÖ}

  jwt:
    header: {JWT hearder ÏÑ∏ÌåÖ}
    secret: {JWT Secret ÏÑ∏ÌåÖ}
    access-token-validity-in-seconds: {access token Ïú†Ìö®Í∏∞Í∞Ñ ÏÑ§Ï†ï}
    refresh-token-validity-in-seconds: {refresh token Ïú†Ìö®Í∏∞Í∞Ñ ÏÑ§Ï†ï}
  elasticsearch:
    uris: {Elascitsearech URL}
    password: {Elasticsearch password}
    username: {Elasticsearch username}

redis:
  master:
    host: {Redis URL}
    port: {Redis port}
  password: {Redis password}

server:
  port: {Server port}
  servlet:
    context-path: {Server context path}

management:
  endpoints:
    enabled-by-default: false
  endpoint:
    health:
      enabled: true

kakao:
  api:
    secret: {kakao REST api key}
  login:
    secret: {kakao REST api key}
    redirect: {kakao login redirect URL}
    tmp-path: {kakao login tmp-path}
swagger:
  local: {swagger local URL}
  production: {swagger production URL}

feign :
  fast-api:
    url: {fast-api URL}
  kakao:
    token: {kakao token URL}
    authorize: {kakao authorize URL}
    user: {kakao user URL}

cloud:
  aws:
    s3:
      bucket: {bucket name}
    credentials:
      access-key: {aws s3 credentials access-key}
      secret-key: {aws s3 credentials secret-key}
    region:
      static: {aws s3 region}
      auto: false
    stack:
      auto: false
    prefix: {aws s3 bucket URL}

default:
  profile:
    image:
      url: {default profile image url}

```

### IDE Î∞è ÌôòÍ≤ΩÏÑ§Ï†ï

```
1. jdk 17 Îã§Ïö¥Î°úÎìú Î∞è ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
2. git clone ÌõÑ backend Ìè¥ÎçîÎ•º IntellijÏóêÏÑú OpenÌïòÏó¨ Í∞ÄÏ†∏Ïò§Í∏∞
3. Intellij - File - Project Structure - ProjectÏóêÏÑú SDKÎ•º 17Î≤ÑÏ†ÑÏúºÎ°ú ÎßûÏ∂îÍ∏∞
4. Intellij - File - Settings - GradleÏóêÏÑú Gradle JVMÏùÑ [1]ÏóêÏÑú Ï∂îÍ∞ÄÌïú ÌôòÍ≤ΩÎ≥ÄÏàòÎ°ú ÏßÄÏ†ï
5. Intellij Ïö∞Ï∏° Gradle ÌÅ¥Î¶≠ ÌõÑ ÏÉàÎ°úÍ≥†Ïπ®
6. Intellij - Run - GitherbsApplicationÏúºÎ°ú Ïã§Ìñâ
```

### Dockerfile (Back)

```docker
FROM openjdk:17-jdk
ADD ./build/libs/githerbs-0.0.1-SNAPSHOT.jar app.jar
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

---

## Frontend Build

### .env

```
VITE_NAVER_CLIENT_KEY={Naver Map APIÏùò Client ID}
```

### IDE Î∞è ÌôòÍ≤ΩÏÑ§Ï†ï

```
1. Node.js 20.11.1 Îã§Ïö¥Î°úÎìú Î∞è ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
2. git clone ÌõÑ frontend Ìè¥ÎçîÎ•º vscodeÏóêÏÑú OpenÌïòÏó¨ Í∞ÄÏ†∏Ïò§Í∏∞
3. npm install
5. frontend Ìè¥Îçî ÏÉÅÏúÑ Í≤ΩÎ°úÏóê .env ÌååÏùº ÏúÑÏπòÏãúÌÇ§Í∏∞
6. npm run build
```

### Dockerfile (Front)

```docker
# Î≤†Ïù¥Ïä§ Ïù¥ÎØ∏ÏßÄÎ°ú Nginx ÏÇ¨Ïö©
FROM nginx:stable-alpine

# Nginx ÏÑ§Ï†ï ÌååÏùº Î≥µÏÇ¨
COPY nginx.conf /etc/nginx/conf.d/default.conf

# JenkinsÏóêÏÑú ÎπåÎìúÎêú Í≤∞Í≥ºÎ¨ºÏùÑ NginxÏùò Ï†ïÏ†Å ÌååÏùº ÎîîÎ†âÌÜ†Î¶¨Î°ú Î≥µÏÇ¨
COPY ./dist /usr/share/nginx/html

# Ìè¨Ìä∏ ÎÖ∏Ï∂ú
EXPOSE 80

# Ïª®ÌÖåÏù¥ÎÑà Ïã§Ìñâ Ïãú Nginx ÏãúÏûë
CMD ["nginx", "-g", "daemon off;"]

```

### **.dockerignore** (Front)

```docker
node_modules
npm-debug.log
build
```

---

### Dockerfile

```
FROM python:3.12.2

# JDK ÏÑ§Ïπò
RUN apt-get update && \
    apt-get install -y default-jdk && \
    apt-get clean

# JAVA_HOME ÌôòÍ≤Ω Î≥ÄÏàò ÏÑ§Ï†ï
ENV JAVA_HOME /usr/lib/jvm/default-java
RUN export JAVA_HOME

WORKDIR /code

COPY ./requirements.txt /code/requirements.txt

RUN pip install --no-cache-dir --upgrade -r /code/requirements.txt

COPY ./main.py /code/
COPY ./recommender.py /code/
COPY herb_medicinal_effect.csv /code/

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "80"]
```

### Docker Ïã§Ìñâ

```
# Ïù¥ÎØ∏ÏßÄ Îã§Ïãú ÎπåÎìúÌïòÍ∏∞
docker build -t **Ïù¥ÎØ∏ÏßÄ Ïù¥Î¶Ñ** .

# ÎπåÎìú Ìïú Ïù¥ÎØ∏ÏßÄ Ïã§Ìñâ
docker run --name **Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ** -d -p **ec2ÏóêÏÑúÏ†ëÏÜçÌï†Ìè¨Ìä∏**:**DockerfileÏóêÏ†ÅÌûåÌè¨Ìä∏** **Ïù¥ÎØ∏ÏßÄÏù¥Î¶Ñ**

# Ïª®ÌÖåÏù¥ÎÑà Î°úÍ∑∏ ÌôïÏù∏
docker logs **Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ**
```

### Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ ÏÑúÎ≤Ñ


## Î∞∞Ìè¨ ÌååÏùº Ìè¥Îçî Íµ¨Ï°∞

```
üì¶githerbs
 ‚î£ üìÇdomain
 ‚îÉ ‚î£ üìÇauth
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇboard
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇevent
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇherb
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇmanual
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚î£ üìÇmember
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇrequest
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚îÉ ‚îó üìÇsearch
 ‚îÉ ‚îÉ ‚î£ üìÇcontroller
 ‚îÉ ‚îÉ ‚î£ üìÇdto
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚îÉ ‚î£ üìÇentity
 ‚îÉ ‚îÉ ‚î£ üìÇrepository
 ‚îÉ ‚îÉ ‚îó üìÇservice
 ‚î£ üìÇglobal
 ‚îÉ ‚î£ üìÇcommon
 ‚îÉ ‚îÉ ‚î£ üìÇcode
 ‚îÉ ‚îÉ ‚î£ üìÇexception
 ‚îÉ ‚îÉ ‚îó üìÇresponse
 ‚îÉ ‚î£ üìÇconfig
 ‚îÉ ‚îó üìÇhandler
 ‚îó üìúGitherbsApplication.java

```

```
üì¶frontend
 ‚î£ üìÇpublic
 ‚îÉ ‚î£ üìÇgrass
 ‚îÉ ‚î£ üìÇherbs
 ‚îÉ ‚î£ üìÇpediaimg
 ‚îÉ ‚î£ üìÇprofileimg
 ‚î£ üìÇsrc
 ‚îÉ ‚î£ üìÇapis
 ‚îÉ ‚î£ üìÇassets
 ‚îÉ ‚îÉ ‚î£ üìÇfonts
 ‚îÉ ‚î£ üìÇcomponents
 ‚îÉ ‚îÉ ‚î£ üìÇboard
 ‚îÉ ‚îÉ ‚î£ üìÇescape
 ‚îÉ ‚îÉ ‚î£ üìÇherbdetail
 ‚îÉ ‚îÉ ‚î£ üìÇmain
 ‚îÉ ‚îÉ ‚î£ üìÇmypage
 ‚îÉ ‚îÉ ‚î£ üìÇpedia
 ‚îÉ ‚îÉ ‚î£ üìÇpicture
 ‚îÉ ‚îÉ ‚î£ üìÇsearch
 ‚îÉ ‚î£ üìÇpages
 ‚îÉ ‚î£ üìÇstore
 ‚îÉ ‚î£ üìÇutils

```

```
üì¶data
 ‚î£ üìÇimage
 ‚îÉ ‚î£ üìÇmodel
 ‚îÉ ‚î£ üìÇnotebook
 ‚îÉ ‚îÉ ‚î£ üìÇoutput
 ‚î£ üìÇsearch
```

# ‚öôÔ∏è Server Settings

## Putty

- PuttyGen Ïù¥Ïö©Ìï¥ .pem -> .ppk Î°ú Î∞îÍæ∏Í∏∞

- Putty ÌÜµÌï¥ EC2 ÏÑúÎ≤ÑÏóê Ï†ëÏÜç
```
1. Category > Connection > SSH > Auth > Credentials ÌÅ¥Î¶≠
2. Public-Key authentication
	- Browse Î°ú ppk ÌååÏùº ÏÑ†ÌÉù
3. Category > Session > Host name (or IP address) Ïóê Ï†úÍ≥µÎ∞õÏùÄ Ï£ºÏÜå ÏûÖÎ†•
4. Port: 22, Connection Type: SSH
5. Open
```

## Server Default Setting

- ÌïúÍµ≠ ÌëúÏ§ÄÏãúÎ°ú Î≥ÄÍ≤Ω

```bash
sudo timedatectl set-timezone Asia/Seoul
```

- Ìå®ÌÇ§ÏßÄ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ Î∞è Ìå®ÌÇ§ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏

```bash
sudo apt-get -y update && sudo apt-get -y upgrade
```

## Docker Setting

- Docker ÏÑ§Ïπò Ï†Ñ ÌïÑÏöîÌïú Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò

```bash
sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
```

- amd / arm ÌôïÏù∏

```bash
dpkg -s libc6 | grep Arch
```

- ÏúÑÏóê Ìï¥ÎãπÌïòÎäî Í≥ÑÏó¥Î°ú Docker Î†àÌè¨ÏßÄÌÜ†Î¶¨ Îì±Î°ù
ÏûÑÏùòÎ°ú amd / arm ‚áí verÎ°ú ÏûëÏÑ±

```bash
sudo add-apt-repository "deb [arch=ver64] https://download.docker.com/linux/ubuntu$(lsb_release -cs) stable"
```

- Ìå®ÌÇ§ÏßÄ Î¶¨Ïä§Ìä∏ Í∞±Ïã†

```bash
sudo apt-get -y update
```

- Docker Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò

```bash
sudo apt-get -y install docker-ce docker-ce-cli containerd.io
```

- Docker ÏÑúÎπÑÏä§ Ïû¨ÏãúÏûë

```bash
sudo service docker restart
exit
```

## SSL Setting

- nginxÎ•º ÏÑ§Ïπò

```bash
sudo apt-get -y install nginx
```

- CertBot Îã§Ïö¥Î°úÎìú

```bash
sudo snap install --classic certbot
```

- SSL Ïù∏Ï¶ùÏÑú Î∞úÍ∏â

```bash
sudo nginx --nginx -d my.domain.com
Ïù¥ÌõÑÏóê Ïù¥Î©îÏùº Ï£ºÏÜå ÏûÖÎ†•
```

## Mysql & Redis

```yaml
version: '3.1'
services:
  mysql:
    image: mysql:8.0
    container_name: mysql
    ports:
      - 3306:3306 # HOST:CONTAINER
    environment:
      MYSQL_ROOT_PASSWORD: {mysql-password}
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
    volumes:
      - /home/ubuntu/docker-compose/mysql/mysql:/var/lib/mysql
    restart: always
  
  redis:
    image: redis
    container_name: redis
    ports:
      - 6379:6379
    volumes:
      - /home/ubuntu/docker-compose/redis/data:/data
      - /home/ubuntu/docker-compose/redis/redis:/usr/local/etc/redis
    command: redis-server /usr/local/etc/redis/redis.conf
```

- [https://raw.githubusercontent.com/redis/redis/7.2/redis.conf](https://raw.githubusercontent.com/redis/redis/7.2/redis.conf) Ï†ëÏÜç ÌõÑ ÌååÏùº Îã§Ïö¥Î°úÎìú, ÏàòÏ†ï

```
# redis.conf
bind 127.0.0.1 -::1 -> bind * -::*
requirepass ->  {Î†àÎîîÏä§ ÎπÑÎ∞ÄÎ≤àÌò∏}
```

## Jenkins

- docker-compose.yml ÏûëÏÑ±

```
version: '3'

services:
  jenkins:
    image: jenkins/jenkins:latest-jdk17
    privileged: true
    user: root
    ports:
      - Ìè¨Ìä∏Î≤àÌò∏!!!:8080
    container_name: Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ!!!!
    volumes:
      - ./jenkins_home:/var/jenkins_home
    restart: unless-stopped
    command: bash -c "apt-get update && apt-get install -y docker.io && jenkins.sh"
```

- docker-compose up -d Ïã§Ìñâ ÌõÑ

```
docker logs Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ!!! Ïã§Ìñâ Í∑∏ ÏïàÏóêÏÑú ÌÜ†ÌÅ∞Ïù¥ Îì±Ïû•
ÏßÄÏ†ïÎêú Ìè¨Ìä∏Î°ú Ï†ëÏÜç ÌõÑ ÌÜ†ÌÅ∞ÏùÑ ÏûÖÎ†• ÌïòÎ©¥ Í∏∞Î≥∏ ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÍ∞Ä Îì±Ïû•
idÏôÄ password ÏÑ§Ï†ï ÌõÑ Í∏∞Î≥∏ ÌîåÎü¨Í∑∏Ïù∏ Îã§Ïö¥Î°úÎìú ÏßÑÌñâ
```

- Ï∂îÍ∞Ä ÌîåÎü¨Í∑∏Ïù∏ ÏÑ§Ïπò

```
SSH Agent

Docker
Docker Commons
Docker Pipeline
Docker API

Generic Webhook Trigger

GitLab
GitLab API,
GitLab Authentication

NodeJS

Mattermost Notification
```

- ÏÉàÎ°úÏö¥ itemÏúºÎ°ú back front ÏïÑÏù¥ÌÖú ÏÉùÏÑ±

```
1. ÏÉùÏÑ± ÌõÑ Build TriggersÏïàÏóê Build when a change is pushed to GitLab. GitLab webhook URL: Ï≤¥ÌÅ¨ ÌõÑ URL Î≥µÏÇ¨
2. push EventsÏôÄ Opened Merge Request Events Ï≤¥ÌÅ¨
3. Í≥†Í∏âÏùÑ ÏÑ†ÌÉù ÌõÑ Secret token Generate Ïã§Ìñâ ÌõÑ Î≥µÏÇ¨
4. ÍπÉÎû© Ï†ëÏÜç ÌõÑ ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù ‚Üí Settings ‚Üí Webhooks Ï†ëÏÜç
5. add new webhook ÏÑ†ÌÉù ÌõÑ jeninsÏóêÏÑú Î≥µÏÇ¨Ìïú URL ÏûÖÎ†•
6. Secret tokenÏóê Î≥µÏÇ¨ÌñàÎçò Secret token ÏûÖÎ†•
7. Ìä∏Î¶¨Í±∞Ïóê push events ÏÑ†ÌÉù ÌõÑ Ï†ÄÏû•
```

## Docker Hub Setting

- Docker Hub Token Î∞úÍ∏â

```
1. Ïö∞Ï∏° ÏÉÅÎã®Ïùò Sign in Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Î°úÍ∑∏Ïù∏
2. Ïö∞Ï∏° ÏÉÅÎã®Ïùò Í≥ÑÏ†ïÎ™ÖÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Account Settings ÌÅ¥Î¶≠
3. New Access Token - Read,Write,Delete Í∂åÌïúÏùÑ Í∞ÄÏßÑ Token Î∞úÍ∏â
4. Token Í∞í Ï†ÄÏû•
```

- Docker Hub Repository ÏÉùÏÑ±

```
1. ÏÉÅÎã®Ïùò Repositories - Create repository ÌÅ¥Î¶≠
2. Visibility ÏßÄÏ†ï ÌõÑ Create ÌÅ¥Î¶≠
```

## Jenkins Pipeline Setting

- ÌîåÎü¨Í∑∏Ïù∏ ÏÑ§Ïπò
    - Jenkins Í¥ÄÎ¶¨ - Plugins - Available Plugins - ÏÑ†ÌÉù ÌõÑ Install without restart ÌÅ¥Î¶≠

```
SSH Agent

Docker
Docker Commons
Docker Pipeline
Docker API

Generic Webhook Trigger

GitLab
GitLab API,
GitLab Authentication
```

- Docker Hub Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with password
Username: Docker HubÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî ID
Password: Docker HubÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî Token Í∞í
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
```

- GitLab Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with password
Username: GitLab Í≥ÑÏ†ï ÏïÑÏù¥Îîî ÏûÖÎ†•
Password: GitLab Í≥ÑÏ†ï ÎπÑÎ∞ÄÎ≤àÌò∏
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
```

- Ubuntu Credential Îì±Î°ù
    - Jenkins Í¥ÄÎ¶¨ - Plugins - Available Plugins - SSH Agent
    - Jenkins Í¥ÄÎ¶¨ - Credentials - global - Add Credentials - Create

```
Kind: Username with private key
ID: CredentialÏóê ÎåÄÌïú Î≥ÑÏπ≠
Username: SSH ÏõêÍ≤© ÏÑúÎ≤Ñ Ìò∏Ïä§Ìä∏ÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî Í≥ÑÏ†ïÎ™Ö(ubuntu)
====> Enter directly - Add ÌÅ¥Î¶≠
.pem ÌÇ§Ïùò ÎÇ¥Ïö©ÏùÑ Î©îÎ™®Ïû•ÏùÑ ÏùΩÏñ¥ Î≥µÏÇ¨ ÌõÑ KeyÏóê Î∂ôÏó¨ÎÑ£ÏùÄ ÌõÑ Create
```

- Gradle Ï∂îÍ∞Ä
    - Jenkins Í¥ÄÎ¶¨ - Tools

```
name: gradle
Install automatically Ï≤¥ÌÅ¨
ÌîÑÎ°úÏ†ùÌä∏ Î≤ÑÏ†ÑÏóê ÎßûÎäî Gradle ÏÑ†ÌÉù ÌõÑ Save
```


# üíΩ Data Import

```
1. Mysql Workbench Ï†ëÏÜç
2. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏôÄ Ïó∞Í≤∞
3. ÏÉÅÎã®Ïùò server - Data Import ÏÑ†ÌÉù
4. Import from Self-Contained File ÏÑ†ÌÉù ÌõÑ sql ÌååÏùº ÏÑ†ÌÉù
5. Default Target SchemaÏóêÏÑú ÏÇ¨Ïö©Ìï† Schema ÏÑ†ÌÉù
6. Start Import ÏÑ†ÌÉù
```

# üé¨ Deployment Command

## Pipeline (Back)

```bash
pipeline {
    agent any
    
    environment {
        imagename = "dockerhub repo Ïù¥Î¶Ñ" // ÏÇ¨Ïö©ÏûêÎ™Ö/repoÎ™Ö
        registryCredential = 'dockerhub' // docker hub credential ID
        dockerImage = ''
        releaseServerAccount = 'ubuntu'
        releaseServerUri = 'i11a409.p.ssafy.io'
        // releasePort = '8080' // Spring bootÎäî 8080 Ìè¨Ìä∏
    }
    
    tools {
        gradle 'gradle'
    }
    
    stages {
        stage('clone') {
            steps {
                git branch: 'Î∏åÎûúÏπòÎ™Ö', credentialsId: 'credentialÎ™Ö', url: 'https~.git ÌòïÏãùÏùò Git Ï£ºÏÜå'
            }
        }
        stage('back_build') {
            steps {
                dir('kiot') { // ÌïòÏúÑÏùò 'kiot' ÎîîÎ†âÌÜ†Î¶¨Î°ú Ïù¥Îèô
                    sh "chmod +x gradlew"
                    sh "./gradlew clean bootJar"
                }
            }
        }
        stage('docker-build'){
            steps {
                dir('kiot'){
                    script {
                        docker.withRegistry('', registryCredential) {
                        sh "docker buildx create --use --name mybuilder"
                        sh "docker buildx build --platform linux/amd64,linux/arm64 -t $imagename:$BUILD_NUMBER --push ."
                        sh "docker buildx build --platform linux/amd64,linux/arm64 -t $imagename:latest --push ."
                    }
                    }
                }
            }
        }
        
        stage('Before Service Stop') {
            steps {
                sshagent(credentials: ['CommonEC2']) {
                    sh '''
                    if test "`ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker ps -aq --filter ancestor=$imagename:latest"`"; then
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker stop $(docker ps -aq --filter ancestor=$imagename:latest)"
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker rm -f $(docker ps -aq --filter ancestor=$imagename:latest)"
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker rmi $imagename:latest"
                    fi
                    '''
                }
            }
        }
        stage('SSH-Server-EC2'){
            steps {
                echo 'SSH'
                
                sshagent(credentials: ['CommonEC2']) {
                    
                    sh 'ssh -o StrictHostKeyChecking=no ubuntu@i11a409.p.ssafy.io "docker pull ennw00/kiotserver:latest"'
                    sh 'ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "sudo docker run -d -i -v ~/keystore_dev.p12:/app/keystore_dev.p12 --env-file ~/.env --name kiotserver -p 8443:8443 $imagename:latest"'
                } 
            }
        }
    }
}
```

## Pipeline (Flask)

```bash
pipeline {
    agent any
    
    environment {
        imagename = "dockerhub repo Ïù¥Î¶Ñ" // ex: ÏÇ¨Ïö©ÏûêÎ™Ö/repoÎ™Ö
        registryCredential = 'dockerhub'
        dockerImage = ''
        releaseServerAccount = 'ubuntu'
        releaseServerUri = 'i11a409.p.ssafy.io'
        // releasePort = '5000' // FlaskÏùò Ìè¨Ìä∏Îäî 5000
    }
    
    stages {
        stage('clone') {
            steps {
                git branch: 'Î∏åÎûúÏπòÎ™Ö', credentialsId: 'gitlabClaire', url: 'https://lab.ssafy.com/s11-webmobile2-sub2/S11P12A409.git'
            }
        }
        
        stage('docker-build'){
            steps {
                dir('Flask'){ // flask Î∏åÎûúÏπò > Flask Ìè¥ÎçîÎ°ú ÏßÑÏûÖ
                    script {
                        docker.withRegistry('', registryCredential) {
                        sh "docker buildx create --use --name mybuilder"
                        sh "docker buildx build --platform linux/amd64,linux/arm64 -t $imagename:$BUILD_NUMBER --push ."
                        sh "docker buildx build --platform linux/amd64,linux/arm64 -t $imagename:latest --push ."
                    }
                    }
                }
            }
        }
        stage('Before Service Stop') {
            steps {
                sshagent(credentials: ['CommonEC2']) {
                    sh '''
                    if test "`ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker ps -aq --filter ancestor=$imagename:latest"`"; then
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker stop $(docker ps -aq --filter ancestor=$imagename:latest)"
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker rm -f $(docker ps -aq --filter ancestor=$imagename:latest)"
                    ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "docker rmi $imagename:latest"
                    fi
                    '''
                }
            }
        }
        stage('SSH-Server-EC2'){
            steps {
                echo 'SSH'
                
                sshagent(credentials: ['CommonEC2']) {
                    
                    sh 'ssh -o StrictHostKeyChecking=no ubuntu@i11a409.p.ssafy.io "docker pull ennw00/kiotflask:latest"'
                    sh 'ssh -o StrictHostKeyChecking=no $releaseServerAccount@$releaseServerUri "sudo docker run -d -i -e TZ=Asia/Seoul -e PYANNOTE_TOKEN=ÌÜ†ÌÅ∞Í∞í -e SECRET_KEY=ÏãúÌÅ¨Î¶øÌÇ§ Í∞í --name kiotflask -p 5000:5000 $imagename:latest"'
                    
                } 
            }
        }
    }
}
```
